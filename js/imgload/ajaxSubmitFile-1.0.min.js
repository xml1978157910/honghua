(function($) {
	$.fn
			.extend({
				submitFile : function(options) {
					var defaults = {
						action : '',
						type : 'json',
						verify : 'img',
						zindex : 99,
						before : function() {
//							$("#submitFile_file_load-logo").css("z-index",0);
//							opts.zindex = 0;
						},
						success : function(txt, dom) {alert(1)
							$("#submitFile_file_load-logo").css("z-index",-1);
							opts.zindex = -1;
						}
					};
					var opts = $.extend(defaults, options);
					var id = $(this).attr("id");
					var width = $(this).width();
					var height = $(this).height();
					var offset = $(this).offset();
					var file_upload_id = "file_upload_" + id;
					var file_upload_obj = $("#" + file_upload_id);
					if (file_upload_obj != null) {
						file_upload_obj.remove();
					}
					var objForm = '<div id='
							+ file_upload_id
							+ ' style="width:'+width+'px;height:'+height+'px;position:absolute;overflow:hidden;left:'
							+ offset.left
							+ 'px;top:'
							+ offset.top
							+ 'px;"><form id="submitFile_form_'
							+ id
							+ '" action="'
							+ opts.action
							+ '" method="post" enctype="multipart/form-data"><input id="submitFile_file_'
							+ id
							+ '" name="upload'
							+ '" type="file" style="margin:0auto;cursor:pointer;text-align:right;z-index:'
							+ opts.zindex
							+ ';font-size:1000px;position:absolute;top:0px;left:0px;opacity:0;filter:Alpha(opacity:0);width:'+width+'px;height:'+height+'px;overflow:hidden;"></form></div>';
					$("body").append(objForm);
					$("#submitFile_file_" + id).change(function() {
						if (verify()) {
							addLoad() ;
							opts.before();
							$("#submitFile_form_" + id).submit();
						}
						return false;
					});
					$(this).click(function(){$("#submitFile_file_" + id).click();})
					function verify() {
						if ("img" == opts.verify) {
							var fileFullName = $("#submitFile_file_" + id)
									.val();
							var strRegex = "(.xls|.jpg|.png|.gif|.bmp|.jpeg|.mp3|.doc|)$";
							var re = new RegExp(strRegex);
							
							if (re.test(fileFullName.toLowerCase())) {
								return true;
							} else {
								alert("文件格式有误！");
								return false;
							}
						}
						return true;
					}
					var thisObj = this;
					$("#submitFile_form_" + id).ajaxForm({
						success : function(txt) {
							if ("json" == opts.type) {
								return opts.success($.parseJSON(txt), thisObj);
							} else {
								return opts.success(txt, thisObj);
							}
						}
					});
				}
			})
})(jQuery);